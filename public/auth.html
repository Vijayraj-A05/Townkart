<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TownKart | Authentication</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --primary:#1A73E8;
      --accent:#FF6F00;
      --muted:#666;
      --card-radius:18px;
      --gap:18px;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    html,body{height:100%;margin:0;font-family: 'Segoe UI', Roboto, Arial, sans-serif;background:linear-gradient(135deg,#f6f8ff,#e8eeff);}

    /* Page centering */
    .page-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box}

    /* Card */
    #auth-card{background:white;border-radius:var(--card-radius);width:100%;max-width:440px;box-shadow:0 12px 40px rgba(0,0,0,0.08);overflow:hidden}

    /* Header */
    .auth-header{background:linear-gradient(to right,var(--primary),#6C5CE7);padding:24px 16px 18px;text-align:center;color:#fff}
    .auth-brand{background:white;display:inline-flex;align-items:center;gap:10px;padding:8px 18px;border-radius:12px;color:var(--primary);font-weight:700}
    .auth-sub{margin-top:10px;color:rgba(255,255,255,0.95);font-size:14px}

    /* Tabs */
    .tabs{display:flex}
    .tabs{border-bottom:1px solid #eee}
    .tab{flex:1;padding:12px 14px;text-align:center;cursor:pointer;font-weight:700}
    .tab.active{background:var(--primary);color:#fff}
    .tab.inactive{background:transparent;color:var(--primary)}
    .tab{border-right:1px solid #eee}
    .tab:last-child{border-right:none}

    /* Form area */
    .form-area{padding:26px;animation:fadeIn .4s}
    .form-area h2{margin:0;text-align:center;color:var(--primary)}
    .form-row{margin-top:20px}
    .field{position:relative;margin-bottom:16px}
    .input-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--primary);z-index:2;pointer-events:none}
    input{width:100%;padding:13px 14px 13px 44px;border:1px solid #e6e6e6;border-radius:10px;font-size:14px;box-sizing:border-box}
    input:focus{border-color:var(--primary);box-shadow:0 6px 18px rgba(26,115,232,0.08);outline:none}

    .controls{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
    .small-link{color:var(--primary);cursor:pointer;font-size:14px}

    button.btn{width:100%;padding:12px;border:none;border-radius:10px;color:#fff;font-size:15px;font-weight:700;cursor:pointer}
    .btn-login{background:var(--primary)}
    .btn-login:hover{background:#0d47a1}
    .btn-signup{background:var(--accent)}
    .btn-signup:hover{background:#e55b00}

    .social-row{display:flex;align-items:center;gap:12px;justify-content:center;margin-top:18px}
    .social-btn{width:44px;height:44px;border-radius:50%;border:1px solid #eee;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}

    /* Forgot section */
    #forgot-section{margin-top:12px}

    /* Responsive adjustments */
    @media (max-width:520px){
      #auth-card{max-width:100%;border-radius:12px}
      .auth-header{padding:18px}
      .form-area{padding:18px}
      input{padding:12px 12px 12px 42px}
    }
  </style>
</head>

  <body>
    <div class="page-wrap">
      <div id="auth-card">

    <!-- HEADER -->
    <div class="auth-header">
      <div class="auth-brand">
        <i class="fas fa-store" style="font-size:20px;color:var(--primary)"></i>
        <span style="font-size:18px;">TownKart</span>
      </div>
      <p class="auth-sub">Premium Shopping Experience</p>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <div id="login-tab" class="tab active" onclick="showLogin()">Login</div>
      <div id="signup-tab" class="tab inactive" onclick="showSignup()">Sign Up</div>
    </div>

    <!-- LOGIN FORM -->
    <div id="login-form" class="form-area" style="display:block;">
      <h2 style="text-align:center; color:#1A73E8;">Welcome Back</h2>

      <div style="margin-top:25px;">
        <div class="field">
          <i class="fas fa-envelope input-icon"></i>
          <input id="loginEmail" type="email" placeholder="Email address">
        </div>

        <div class="field">
          <i class="fas fa-lock input-icon"></i>
          <input id="loginPass" type="password" placeholder="Password">
        </div>

        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
          <label><input type="checkbox" style="accent-color:#1A73E8;"> Remember me</label>
          <span class="small-link" onclick="showForgot()">Forgot?</span>
        </div>

        <button id="loginBtn" class="btn btn-login">Login</button>

        <div id="forgot-section" style="display:none; margin-top:20px;">
          <div class="field">
            <input id="forgotEmail" type="email" placeholder="Enter email to reset">
          </div>
          <button id="forgotBtn" class="btn" style="margin-top:10px; background:#888;">Send Reset Email</button>
          <p id="forgotMsg" style="margin-top:10px; font-size:13px;"></p>
        </div>

        <div style="text-align:center; margin-top:25px;">
          <p style="color:#555;">Or login with</p>
          <div id="googleLoginBtn" class="social-btn"><i class="fab fa-google" style="color:#DB4437;"></i></div>
        </div>
      </div>
    </div>

    <!-- SIGNUP FORM -->
    <div id="signup-form" class="form-area" style="display:none;">
      <h2 style="text-align:center; color:#1A73E8;">Create Account</h2>

      <div style="margin-top:25px;">
        <div style="position:relative; margin-bottom:18px;">
          <i class="fas fa-user input-icon"></i>
          <input id="signupName" type="text" placeholder="Full name">
        </div>

        <div style="position:relative; margin-bottom:18px;">
          <i class="fas fa-envelope input-icon"></i>
          <input id="signupEmail" type="email" placeholder="Email address">
        </div>

        <div style="position:relative; margin-bottom:18px;">
          <i class="fas fa-lock input-icon"></i>
          <input id="signupPass" type="password" placeholder="Password">
        </div>

        <div style="position:relative; margin-bottom:18px;">
          <i class="fas fa-lock input-icon"></i>
          <input id="signupConfirm" type="password" placeholder="Confirm password">
        </div>

        <label style="display:flex; margin-bottom:20px;">
          <input id="termsCheck" type="checkbox" style="margin-right:10px; accent-color:#1A73E8;">
          Accept Terms & Privacy Policy
        </label>

        <button id="signupBtn" class="btn btn-signup">Create Account</button>

        <div style="text-align:center; margin-top:25px;">
          <p style="color:#555;">Or sign up with</p>
          <div id="googleSignupBtn" class="social-btn"><i class="fab fa-google" style="color:#DB4437;"></i></div>
        </div>
      </div>
    </div>

  </div>
  </div>

  <!-- TAB SCRIPT -->
  <script>
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const loginTab = document.getElementById('login-tab');
    const signupTab = document.getElementById('signup-tab');
    const forgotSection = document.getElementById('forgot-section');

    function showLogin() {
      if (loginForm) loginForm.style.display = 'block';
      if (signupForm) signupForm.style.display = 'none';
      if (loginTab) { loginTab.classList.add('active'); loginTab.classList.remove('inactive'); }
      if (signupTab) { signupTab.classList.add('inactive'); signupTab.classList.remove('active'); }
    }

    function showSignup() {
      if (signupForm) signupForm.style.display = 'block';
      if (loginForm) loginForm.style.display = 'none';
      if (signupTab) { signupTab.classList.add('active'); signupTab.classList.remove('inactive'); }
      if (loginTab) { loginTab.classList.add('inactive'); loginTab.classList.remove('active'); }
    }

    function showForgot() {
      if (!forgotSection) return;
      forgotSection.style.display = (forgotSection.style.display === 'block') ? 'none' : 'block';
    }
  </script>

  <!-- FIREBASE SCRIPT -->
  <script type="module">

    /* IMPORTS (ONE VERSION ONLY â€” 10.7.0) */
    import { initializeApp } 
      from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";

    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
      GoogleAuthProvider, signInWithPopup, updateProfile,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

    import {
      getFirestore, doc, setDoc
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    /* FIREBASE CONFIG */
    const firebaseConfig = {
      apiKey: "AIzaSyBi5Yd7oqhRoo4ATEb78U3POkeJrCbDUTU",
      authDomain: "townkart-d604a.firebaseapp.com",
      projectId: "townkart-d604a",
      storageBucket: "townkart-d604a.appspot.com",
      messagingSenderId: "223214079906",
      appId: "1:223214079906:web:9f78fdeda7a23623252cfb",
      measurementId: "G-5P8CF04MFC"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    function gotoHome() {
      window.location.href = "home.html";
    }

    /* SIGNUP */
    signupBtn.onclick = async () => {
      let name = signupName.value;
      let email = signupEmail.value;
      let pw = signupPass.value;
      let cpw = signupConfirm.value;

      if (!name || !email || !pw) return alert("Fill all fields");
      if (pw !== cpw) return alert("Passwords do not match");

      try {
        let userCred = await createUserWithEmailAndPassword(auth, email, pw);

        await updateProfile(userCred.user, { displayName: name });

        await setDoc(doc(db, "users", userCred.user.uid), {
          name, email,
          createdAt: new Date().toISOString()
        });

        alert("Signup Successful!");
        gotoHome();
      } catch (e) { alert(e.message); }
    };

    /* LOGIN */
    loginBtn.onclick = async () => {
      let email = loginEmail.value;
      let pw = loginPass.value;

      try {
        await signInWithEmailAndPassword(auth, email, pw);
        alert("Login success!");
        gotoHome();
      } catch (e) { alert(e.message); }
    };

    /* GOOGLE LOGIN */
    function googleAuth() {
      signInWithPopup(auth, provider)
        .then(async (result) => {
          let user = result.user;

          await setDoc(doc(db, "users", user.uid), {
            name: user.displayName,
            email: user.email,
            createdAt: new Date().toISOString()
          }, { merge: true });

          alert("Google login success!");
          gotoHome();
        })
        .catch(err => alert(err.message));
    }

    googleLoginBtn.onclick = googleAuth;
    googleSignupBtn.onclick = googleAuth;

    /* FORGOT PASSWORD */
    forgotBtn.onclick = async () => {
      let email = forgotEmail.value;
      try {
        await sendPasswordResetEmail(auth, email);
        forgotMsg.style.color = "green";
        forgotMsg.innerHTML = "Reset Email Sent!";
      } catch (e) {
        forgotMsg.style.color = "red";
        forgotMsg.innerHTML = e.message;
      }
    };

  </script>

</body>
</html>
